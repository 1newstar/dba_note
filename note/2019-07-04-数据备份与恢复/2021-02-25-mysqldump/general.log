

# 加 single-transaction 参数 的备份
# 不加 single-transaction参数 的备份
# MyISAM和InnoDB表同时存在



mysql> mysqldump  -h192.168.0.54 -uroot -p123456abc --set-gtid-purged=OFF --single-transaction --master-data=2 -B archery > archery.sql


/usr/local/mysql/bin/mysqld, Version: 5.7.22-log (MySQL Community Server (GPL)). started with:
Tcp port: 3306  Unix socket: /tmp/mysql3306.sock
Time                 Id Command    Argument
2019-07-03T11:41:01.705532+08:00	    3 Connect	root@192.168.0.54 on  using TCP/IP
2019-07-03T11:41:01.705771+08:00	    3 Query	/*!40100 SET @@SQL_MODE='' */
2019-07-03T11:41:01.705885+08:00	    3 Query	/*!40103 SET TIME_ZONE='+00:00' */
2019-07-03T11:41:01.706009+08:00	    3 Query	FLUSH /*!40101 LOCAL */ TABLES

2019-07-03T11:41:01.708492+08:00	    3 Query	FLUSH TABLES WITH READ LOCK
2019-07-03T11:41:01.708626+08:00	    3 Query	SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ
2019-07-03T11:41:01.708703+08:00	    3 Query	START TRANSACTION /*!40100 WITH CONSISTENT SNAPSHOT */
2019-07-03T11:41:01.708898+08:00	    3 Query	SHOW MASTER STATUS
2019-07-03T11:41:01.709021+08:00	    3 Query	UNLOCK TABLES
2019-07-03T11:41:01.709262+08:00	    3 Query	SELECT LOGFILE_GROUP_NAME, FILE_NAME, TOTAL_EXTENTS, INITIAL_SIZE, ENGINE, EXTRA FROM INFORMATION_SCHEMA.FILES WHERE FILE_TYPE = 'UNDO LOG' AND FILE_NAME IS NOT NULL AND LOGFILE_GROUP_NAME IS NOT NULL AND LOGFILE_GROUP_NAME IN (SELECT DISTINCT LOGFILE_GROUP_NAME FROM INFORMATION_SCHEMA.FILES WHERE FILE_TYPE = 'DATAFILE' AND TABLESPACE_NAME IN (SELECT DISTINCT TABLESPACE_NAME FROM INFORMATION_SCHEMA.PARTITIONS WHERE TABLE_SCHEMA IN ('archery'))) GROUP BY LOGFILE_GROUP_NAME, FILE_NAME, ENGINE, TOTAL_EXTENTS, INITIAL_SIZE ORDER BY LOGFILE_GROUP_NAME
2019-07-03T11:41:01.792152+08:00	    3 Query	SELECT DISTINCT TABLESPACE_NAME, FILE_NAME, LOGFILE_GROUP_NAME, EXTENT_SIZE, INITIAL_SIZE, ENGINE FROM INFORMATION_SCHEMA.FILES WHERE FILE_TYPE = 'DATAFILE' AND TABLESPACE_NAME IN (SELECT DISTINCT TABLESPACE_NAME FROM INFORMATION_SCHEMA.PARTITIONS WHERE TABLE_SCHEMA IN ('archery')) ORDER BY TABLESPACE_NAME, LOGFILE_GROUP_NAME
2019-07-03T11:41:01.795142+08:00	    3 Query	SHOW VARIABLES LIKE 'ndbinfo\_version'
2019-07-03T11:41:01.797436+08:00	    3 Init DB	archery
2019-07-03T11:41:01.797527+08:00	    3 Query	SHOW CREATE DATABASE IF NOT EXISTS `archery`
2019-07-03T11:41:01.797621+08:00	    3 Query	SAVEPOINT sp
2019-07-03T11:41:01.797700+08:00	    3 Query	show tables
2019-07-03T11:41:01.798043+08:00	    3 Query	show table status like 'mysql\_slow\_query\_review'
2019-07-03T11:41:01.798343+08:00	    3 Query	SET SQL_QUOTE_SHOW_CREATE=1
2019-07-03T11:41:01.798432+08:00	    3 Query	SET SESSION character_set_results = 'binary'
2019-07-03T11:41:01.798514+08:00	    3 Query	show create table `mysql_slow_query_review`
2019-07-03T11:41:01.798709+08:00	    3 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T11:41:01.798811+08:00	    3 Query	show fields from `mysql_slow_query_review`
2019-07-03T11:41:01.799292+08:00	    3 Query	show fields from `mysql_slow_query_review`
2019-07-03T11:41:01.799737+08:00	    3 Query	SELECT /*!40001 SQL_NO_CACHE */ * FROM `mysql_slow_query_review`
2019-07-03T11:41:01.800017+08:00	    3 Query	SET SESSION character_set_results = 'binary'
2019-07-03T11:41:01.800118+08:00	    3 Query	use `archery`
2019-07-03T11:41:01.800204+08:00	    3 Query	select @@collation_database
2019-07-03T11:41:01.800303+08:00	    3 Query	SHOW TRIGGERS LIKE 'mysql\_slow\_query\_review'
2019-07-03T11:41:01.800744+08:00	    3 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T11:41:01.800836+08:00	    3 Query	ROLLBACK TO SAVEPOINT sp
2019-07-03T11:41:01.801058+08:00	    3 Query	show table status like 'mysql\_slow\_query\_review\_history'
2019-07-03T11:41:01.801313+08:00	    3 Query	SET SQL_QUOTE_SHOW_CREATE=1
2019-07-03T11:41:01.801431+08:00	    3 Query	SET SESSION character_set_results = 'binary'
2019-07-03T11:41:01.801512+08:00	    3 Query	show create table `mysql_slow_query_review_history`
2019-07-03T11:41:01.801748+08:00	    3 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T11:41:01.802022+08:00	    3 Query	show fields from `mysql_slow_query_review_history`
2019-07-03T11:41:01.803096+08:00	    3 Query	show fields from `mysql_slow_query_review_history`
2019-07-03T11:41:01.804176+08:00	    3 Query	SELECT /*!40001 SQL_NO_CACHE */ * FROM `mysql_slow_query_review_history`
2019-07-03T11:41:01.804606+08:00	    3 Query	SET SESSION character_set_results = 'binary'
2019-07-03T11:41:01.804690+08:00	    3 Query	use `archery`
2019-07-03T11:41:01.804770+08:00	    3 Query	select @@collation_database
2019-07-03T11:41:01.804860+08:00	    3 Query	SHOW TRIGGERS LIKE 'mysql\_slow\_query\_review\_history'
2019-07-03T11:41:01.805328+08:00	    3 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T11:41:01.805440+08:00	    3 Query	ROLLBACK TO SAVEPOINT sp
2019-07-03T11:41:01.805510+08:00	    3 Query	RELEASE SAVEPOINT sp
2019-07-03T11:41:01.812638+08:00	    3 Quit	



# 不加 single-transaction参数 的备份
mysql> mysqldump  -h192.168.0.54 -uroot -p123456abc --set-gtid-purged=OFF --master-data=2 -B archery > archery_02.sql

2019-07-03T11:58:34.141861+08:00	    9 Connect	root@192.168.0.54 on  using TCP/IP
2019-07-03T11:58:34.142043+08:00	    9 Query	/*!40100 SET @@SQL_MODE='' */
2019-07-03T11:58:34.142161+08:00	    9 Query	/*!40103 SET TIME_ZONE='+00:00' */
2019-07-03T11:58:34.142276+08:00	    9 Query	FLUSH /*!40101 LOCAL */ TABLES

2019-07-03T11:58:34.142386+08:00	    9 Query	FLUSH TABLES WITH READ LOCK

2019-07-03T11:58:34.142536+08:00	    9 Query	SHOW MASTER STATUS
2019-07-03T11:58:34.142738+08:00	    9 Query	SELECT LOGFILE_GROUP_NAME, FILE_NAME, TOTAL_EXTENTS, INITIAL_SIZE, ENGINE, EXTRA FROM INFORMATION_SCHEMA.FILES WHERE FILE_TYPE = 'UNDO LOG' AND FILE_NAME IS NOT NULL AND LOGFILE_GROUP_NAME IS NOT NULL AND LOGFILE_GROUP_NAME IN (SELECT DISTINCT LOGFILE_GROUP_NAME FROM INFORMATION_SCHEMA.FILES WHERE FILE_TYPE = 'DATAFILE' AND TABLESPACE_NAME IN (SELECT DISTINCT TABLESPACE_NAME FROM INFORMATION_SCHEMA.PARTITIONS WHERE TABLE_SCHEMA IN ('archery'))) GROUP BY LOGFILE_GROUP_NAME, FILE_NAME, ENGINE, TOTAL_EXTENTS, INITIAL_SIZE ORDER BY LOGFILE_GROUP_NAME
2019-07-03T11:58:34.149302+08:00	    9 Query	SELECT DISTINCT TABLESPACE_NAME, FILE_NAME, LOGFILE_GROUP_NAME, EXTENT_SIZE, INITIAL_SIZE, ENGINE FROM INFORMATION_SCHEMA.FILES WHERE FILE_TYPE = 'DATAFILE' AND TABLESPACE_NAME IN (SELECT DISTINCT TABLESPACE_NAME FROM INFORMATION_SCHEMA.PARTITIONS WHERE TABLE_SCHEMA IN ('archery')) ORDER BY TABLESPACE_NAME, LOGFILE_GROUP_NAME
2019-07-03T11:58:34.152392+08:00	    9 Query	SHOW VARIABLES LIKE 'ndbinfo\_version'
2019-07-03T11:58:34.154844+08:00	    9 Init DB	archery
2019-07-03T11:58:34.154910+08:00	    9 Query	SHOW CREATE DATABASE IF NOT EXISTS `archery`
2019-07-03T11:58:34.154977+08:00	    9 Query	show tables
2019-07-03T11:58:34.155158+08:00	    9 Query	show table status like 'mysql\_slow\_query\_review'
2019-07-03T11:58:34.155317+08:00	    9 Query	SET SQL_QUOTE_SHOW_CREATE=1
2019-07-03T11:58:34.155371+08:00	    9 Query	SET SESSION character_set_results = 'binary'
2019-07-03T11:58:34.155420+08:00	    9 Query	show create table `mysql_slow_query_review`
2019-07-03T11:58:34.155519+08:00	    9 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T11:58:34.155578+08:00	    9 Query	show fields from `mysql_slow_query_review`
2019-07-03T11:58:34.155847+08:00	    9 Query	show fields from `mysql_slow_query_review`
2019-07-03T11:58:34.156162+08:00	    9 Query	SELECT /*!40001 SQL_NO_CACHE */ * FROM `mysql_slow_query_review`
2019-07-03T11:58:34.156321+08:00	    9 Query	SET SESSION character_set_results = 'binary'
2019-07-03T11:58:34.156412+08:00	    9 Query	use `archery`
2019-07-03T11:58:34.156471+08:00	    9 Query	select @@collation_database
2019-07-03T11:58:34.156535+08:00	    9 Query	SHOW TRIGGERS LIKE 'mysql\_slow\_query\_review'
2019-07-03T11:58:34.156762+08:00	    9 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T11:58:34.156878+08:00	    9 Query	show table status like 'mysql\_slow\_query\_review\_history'
2019-07-03T11:58:34.157026+08:00	    9 Query	SET SQL_QUOTE_SHOW_CREATE=1
2019-07-03T11:58:34.157073+08:00	    9 Query	SET SESSION character_set_results = 'binary'
2019-07-03T11:58:34.157119+08:00	    9 Query	show create table `mysql_slow_query_review_history`
2019-07-03T11:58:34.157355+08:00	    9 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T11:58:34.157445+08:00	    9 Query	show fields from `mysql_slow_query_review_history`
2019-07-03T11:58:34.158061+08:00	    9 Query	show fields from `mysql_slow_query_review_history`
2019-07-03T11:58:34.158836+08:00	    9 Query	SELECT /*!40001 SQL_NO_CACHE */ * FROM `mysql_slow_query_review_history`
2019-07-03T11:58:34.159179+08:00	    9 Query	SET SESSION character_set_results = 'binary'
2019-07-03T11:58:34.159241+08:00	    9 Query	use `archery`
2019-07-03T11:58:34.159299+08:00	    9 Query	select @@collation_database
2019-07-03T11:58:34.159361+08:00	    9 Query	SHOW TRIGGERS LIKE 'mysql\_slow\_query\_review\_history'
2019-07-03T11:58:34.159702+08:00	    9 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T11:58:34.164381+08:00	    9 Quit	


MyISAM和InnoDB表同时存在:
CREATE TABLE `product` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键Id',
  `name` varchar(20) DEFAULT NULL,
  `amount` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`)
) ENGINE=MyISAM AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4;


2019-07-03T13:16:19.373362+08:00	   37 Connect	root@192.168.0.54 on  using TCP/IP
2019-07-03T13:16:19.373680+08:00	   37 Query	/*!40100 SET @@SQL_MODE='' */
2019-07-03T13:16:19.373800+08:00	   37 Query	/*!40103 SET TIME_ZONE='+00:00' */
2019-07-03T13:16:19.374076+08:00	   37 Query	FLUSH /*!40101 LOCAL */ TABLES
2019-07-03T13:16:19.374595+08:00	   37 Query	FLUSH TABLES WITH READ LOCK
2019-07-03T13:16:19.374837+08:00	   37 Query	SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ
2019-07-03T13:16:19.374954+08:00	   37 Query	START TRANSACTION /*!40100 WITH CONSISTENT SNAPSHOT */
2019-07-03T13:16:19.375051+08:00	   37 Query	SHOW MASTER STATUS
2019-07-03T13:16:19.375239+08:00	   37 Query	UNLOCK TABLES
2019-07-03T13:16:19.375453+08:00	   37 Query	SELECT LOGFILE_GROUP_NAME, FILE_NAME, TOTAL_EXTENTS, INITIAL_SIZE, ENGINE, EXTRA FROM INFORMATION_SCHEMA.FILES WHERE FILE_TYPE = 'UNDO LOG' AND FILE_NAME IS NOT NULL AND LOGFILE_GROUP_NAME IS NOT NULL AND LOGFILE_GROUP_NAME IN (SELECT DISTINCT LOGFILE_GROUP_NAME FROM INFORMATION_SCHEMA.FILES WHERE FILE_TYPE = 'DATAFILE' AND TABLESPACE_NAME IN (SELECT DISTINCT TABLESPACE_NAME FROM INFORMATION_SCHEMA.PARTITIONS WHERE TABLE_SCHEMA IN ('archery'))) GROUP BY LOGFILE_GROUP_NAME, FILE_NAME, ENGINE, TOTAL_EXTENTS, INITIAL_SIZE ORDER BY LOGFILE_GROUP_NAME
2019-07-03T13:16:19.386280+08:00	   37 Query	SELECT DISTINCT TABLESPACE_NAME, FILE_NAME, LOGFILE_GROUP_NAME, EXTENT_SIZE, INITIAL_SIZE, ENGINE FROM INFORMATION_SCHEMA.FILES WHERE FILE_TYPE = 'DATAFILE' AND TABLESPACE_NAME IN (SELECT DISTINCT TABLESPACE_NAME FROM INFORMATION_SCHEMA.PARTITIONS WHERE TABLE_SCHEMA IN ('archery')) ORDER BY TABLESPACE_NAME, LOGFILE_GROUP_NAME
2019-07-03T13:16:19.392004+08:00	   37 Query	SHOW VARIABLES LIKE 'ndbinfo\_version'
2019-07-03T13:16:19.394832+08:00	   37 Init DB	archery
2019-07-03T13:16:19.395044+08:00	   37 Query	SHOW CREATE DATABASE IF NOT EXISTS `archery`
2019-07-03T13:16:19.395189+08:00	   37 Query	SAVEPOINT sp
2019-07-03T13:16:19.395289+08:00	   37 Query	show tables
2019-07-03T13:16:19.395584+08:00	   37 Query	show table status like 'mysql\_slow\_query\_review'
2019-07-03T13:16:19.395979+08:00	   37 Query	SET SQL_QUOTE_SHOW_CREATE=1
2019-07-03T13:16:19.396092+08:00	   37 Query	SET SESSION character_set_results = 'binary'
2019-07-03T13:16:19.396194+08:00	   37 Query	show create table `mysql_slow_query_review`
2019-07-03T13:16:19.396389+08:00	   37 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T13:16:19.396508+08:00	   37 Query	show fields from `mysql_slow_query_review`
2019-07-03T13:16:19.397141+08:00	   37 Query	show fields from `mysql_slow_query_review`
2019-07-03T13:16:19.397876+08:00	   37 Query	SELECT /*!40001 SQL_NO_CACHE */ * FROM `mysql_slow_query_review`
2019-07-03T13:16:19.398267+08:00	   37 Query	SET SESSION character_set_results = 'binary'
2019-07-03T13:16:19.398384+08:00	   37 Query	use `archery`
2019-07-03T13:16:19.398492+08:00	   37 Query	select @@collation_database
2019-07-03T13:16:19.398702+08:00	   37 Query	SHOW TRIGGERS LIKE 'mysql\_slow\_query\_review'
2019-07-03T13:16:19.399502+08:00	   37 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T13:16:19.399651+08:00	   37 Query	ROLLBACK TO SAVEPOINT sp

2019-07-03T13:16:19.399780+08:00	   37 Query	show table status like 'mysql\_slow\_query\_review\_history'
2019-07-03T13:16:19.400660+08:00	   37 Query	SET SQL_QUOTE_SHOW_CREATE=1
2019-07-03T13:16:19.400906+08:00	   37 Query	SET SESSION character_set_results = 'binary'
2019-07-03T13:16:19.400978+08:00	   37 Query	show create table `mysql_slow_query_review_history`
2019-07-03T13:16:19.401120+08:00	   37 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T13:16:19.401208+08:00	   37 Query	show fields from `mysql_slow_query_review_history`
2019-07-03T13:16:19.402440+08:00	   37 Query	show fields from `mysql_slow_query_review_history`
2019-07-03T13:16:19.403726+08:00	   37 Query	SELECT /*!40001 SQL_NO_CACHE */ * FROM `mysql_slow_query_review_history`
2019-07-03T13:16:19.404303+08:00	   37 Query	SET SESSION character_set_results = 'binary'
2019-07-03T13:16:19.404452+08:00	   37 Query	use `archery`
2019-07-03T13:16:19.404533+08:00	   37 Query	select @@collation_database
2019-07-03T13:16:19.404611+08:00	   37 Query	SHOW TRIGGERS LIKE 'mysql\_slow\_query\_review\_history'
2019-07-03T13:16:19.405144+08:00	   37 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T13:16:19.405201+08:00	   37 Query	ROLLBACK TO SAVEPOINT sp


2019-07-03T13:16:19.405246+08:00	   37 Query	show table status like 'nproduct'
2019-07-03T13:16:19.405428+08:00	   37 Query	SET SQL_QUOTE_SHOW_CREATE=1
2019-07-03T13:16:19.405469+08:00	   37 Query	SET SESSION character_set_results = 'binary'
2019-07-03T13:16:19.405509+08:00	   37 Query	show create table `nproduct`
2019-07-03T13:16:19.405568+08:00	   37 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T13:16:19.405616+08:00	   37 Query	show fields from `nproduct`
2019-07-03T13:16:19.405865+08:00	   37 Query	show fields from `nproduct`
2019-07-03T13:16:19.406071+08:00	   37 Query	SELECT /*!40001 SQL_NO_CACHE */ * FROM `nproduct`
2019-07-03T13:16:19.406146+08:00	   37 Query	SET SESSION character_set_results = 'binary'
2019-07-03T13:16:19.406220+08:00	   37 Query	use `archery`
2019-07-03T13:16:19.406266+08:00	   37 Query	select @@collation_database
2019-07-03T13:16:19.406314+08:00	   37 Query	SHOW TRIGGERS LIKE 'nproduct'
2019-07-03T13:16:19.406510+08:00	   37 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T13:16:19.406553+08:00	   37 Query	ROLLBACK TO SAVEPOINT sp


2019-07-03T13:16:19.406592+08:00	   37 Query	show table status like 'product'
2019-07-03T13:16:19.406736+08:00	   37 Query	SET SQL_QUOTE_SHOW_CREATE=1
2019-07-03T13:16:19.406786+08:00	   37 Query	SET SESSION character_set_results = 'binary'
2019-07-03T13:16:19.406825+08:00	   37 Query	show create table `product`
2019-07-03T13:16:19.406878+08:00	   37 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T13:16:19.406922+08:00	   37 Query	show fields from `product`
2019-07-03T13:16:19.407153+08:00	   37 Query	show fields from `product`
2019-07-03T13:16:19.407352+08:00	   37 Query	SELECT /*!40001 SQL_NO_CACHE */ * FROM `product`
2019-07-03T13:16:19.407431+08:00	   37 Query	SET SESSION character_set_results = 'binary'
2019-07-03T13:16:19.407472+08:00	   37 Query	use `archery`
2019-07-03T13:16:19.407526+08:00	   37 Query	select @@collation_database
2019-07-03T13:16:19.407580+08:00	   37 Query	SHOW TRIGGERS LIKE 'product'
2019-07-03T13:16:19.407775+08:00	   37 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T13:16:19.407818+08:00	   37 Query	ROLLBACK TO SAVEPOINT sp
2019-07-03T13:16:19.407857+08:00	   37 Query	show table status like 'product\_innodb'
2019-07-03T13:16:19.408004+08:00	   37 Query	SET SQL_QUOTE_SHOW_CREATE=1
2019-07-03T13:16:19.408047+08:00	   37 Query	SET SESSION character_set_results = 'binary'
2019-07-03T13:16:19.408087+08:00	   37 Query	show create table `product_innodb`
2019-07-03T13:16:19.408144+08:00	   37 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T13:16:19.408188+08:00	   37 Query	show fields from `product_innodb`
2019-07-03T13:16:19.408385+08:00	   37 Query	show fields from `product_innodb`
2019-07-03T13:16:19.408602+08:00	   37 Query	SELECT /*!40001 SQL_NO_CACHE */ * FROM `product_innodb`
2019-07-03T13:16:19.408690+08:00	   37 Query	SET SESSION character_set_results = 'binary'
2019-07-03T13:16:19.408731+08:00	   37 Query	use `archery`
2019-07-03T13:16:19.408773+08:00	   37 Query	select @@collation_database
2019-07-03T13:16:19.408819+08:00	   37 Query	SHOW TRIGGERS LIKE 'product\_innodb'
2019-07-03T13:16:19.409051+08:00	   37 Query	SET SESSION character_set_results = 'utf8'
2019-07-03T13:16:19.409095+08:00	   37 Query	ROLLBACK TO SAVEPOINT sp
2019-07-03T13:16:19.409129+08:00	   37 Query	RELEASE SAVEPOINT sp
2019-07-03T13:16:19.413342+08:00	   37 Quit	
