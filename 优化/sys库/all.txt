问题5.  哪些语句延迟比较严重?

statement_analysis中avg_latency的最高的。(参考上面写法)

SQL语句：

select * from sys.statement_analysis order by avg_latency desc limit 10;


统计全表扫描
select * from sys.statements_with_full_table_scans order by exec_count desc;
select * from sys.statements_with_full_table_scans order by exec_count desc;

慢查询

自增ID
select * from sys.schema_auto_increment_columns order by auto_increment_ratio desc;
关注 auto_increment_ratio 列.



监控大事务

过载保护

网易这样用sys schema优雅提升MySQL易用性：
https://mp.weixin.qq.com/s?src=3&timestamp=1526366871&ver=1&signature=4cN2zbsuTbHDkotZNk6LgGJ3gu7wYAv0j0wN7AM-rNdxlXihtGOknRHISvvZYIXyeEQyisJYn9eXLV2AuQvmhTSN6JX6m7CEIHARB0Y1EmbSw9xhLLhNzYyS6s3f8PKKiUew2eoUP0FxQwE4HyTlB1AmujENI*wwp4*KM8ekV1Q=


sys schema中包含了大量的视图（只有sys_config是innodb表），那么，这些视图的信息来自哪里呢？
视图中的信息均来自performance schema和information schema中的统计信息

举个例子:
select digest from sys.statements_with_full_table_scans order by exec_count desc;
select * from `performance_schema`.events_statements_summary_by_digest where digest='4deab4448b08fed845eb2dfd45cd9a41';


微信文章:
	如何查看当前最新事务ID



查看 INFORMATION_SCHEMA.INNODB_TRX、INNODB_LOCKS、INNODB_LOCK_WAITS 三个表，
通过这些信息能快速发现哪些事务在阻塞其他事务

1. 看看都有哪些事务未提交：
SELECT * FROM INFORMATION_SCHEMA.INNODB_TRX\G;
看 trx_state 的状态;


2. 看 INNODB_LOCKS 表，看看都有什么锁:
select * from information_schema.INNODB_LOCKS\G;

3. 看 INNODB_LOCK_WAITS 表，看看当前都有哪些锁等待:
select * from information_schema.INNODB_LOCK_WAITS\G;












微信文章:
	会话和锁信息查询视图 | 全方位认识 sys 系统库
	简要总结mysql几个系统库 
	学习使用MySQL 5.7的sys库（下） 
	沃趣罗小波《全方位认识MySQL sys schema》 
	
	
	
select * from sys.innodb_lock_waits\G;
	 


 	 
